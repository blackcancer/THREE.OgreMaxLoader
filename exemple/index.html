<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>OgreMaxLoader exemple</title>
		<meta http-equiv="Content-Type"		content="text/html; charset=utf-8" />
		<meta name="viewport"				content="width=device-width,user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

               <!--### Loading Libraries ###-->
               <script type="module">
                       import * as THREE from 'https://unpkg.com/three@0.177.0/build/three.module.js';
                       import { OrbitControls } from 'https://unpkg.com/three@0.177.0/examples/jsm/controls/OrbitControls.js';
                       import { OgreMaxLoader, DotMaterialLoader } from '../OgreMaxLoader.js';

                       const container = document.getElementById('container');
                       const clock = new THREE.Clock();
                       const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 100);
                       const loader = new OgreMaxLoader();
                       let scene, renderer, controls, mixer;

                       try {
                               renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                               console.log('WebGLRenderer loaded.');
                       } catch (err) {
                               console.error('Can not load WebGLRenderer.', err);
                               return;
                       }

                       renderer.setSize(window.innerWidth, window.innerHeight);
                       renderer.setPixelRatio(window.devicePixelRatio);
                       container.appendChild(renderer.domElement);

                       camera.position.set(2, 1, 2);
                       camera.updateProjectionMatrix();

                       controls = new OrbitControls(camera, renderer.domElement);

                       // loader.texturePath = './res/otherTextures/';
                       loader.load('./res/models/PlayerMdl.scene', onLoad, e=>{}, err=>{ console.error(err); });

                       function onLoad(loadedScene){
                               const mesh = loadedScene.getObjectByName('PlayerMdl').children[0];

                               const group = new THREE.Group();
                               const axisHelper = new THREE.AxesHelper(5.02);
                               const gridHelper = new THREE.GridHelper(5, 10, new THREE.Color(0x007d00), new THREE.Color(0x007d00));
                               const skelHelper = new THREE.SkeletonHelper(mesh);

                               axisHelper.position.set(-2.51, -0.95, -2.51);
                               gridHelper.position.set(0, -0.95, 0);

                               mixer = new THREE.AnimationMixer(mesh);
                               const saluteAnim = mixer.clipAction('StandESaluteA');
                               saluteAnim.play();

                               group.name = 'external';
                               group.add(axisHelper);
                               group.add(gridHelper);
                               group.add(skelHelper);
                               group.add(camera);
                               loadedScene.add(group);
                               scene = loadedScene;

                               console.log('Finished scene:');
                               console.log(scene);

                               animate();
                       }

                       const animate = () => {
                               requestAnimationFrame(animate);
                               render();
                               controls.update();
                       };

                       const render = () => {
                               const delta = clock.getDelta() * 0.75;
                               if(mixer) mixer.update(delta);
                               renderer.render(scene, camera);
                       };
               </script>
       </head>

	<body style="background-color: #0B0E13;">
		<div id="container"></div>

		
	</body>
</html>